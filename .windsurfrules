1. Code Style & Quality (Pythonâ€‘centric)
* PEPâ€¯8 + PEPâ€¯257 complianceEnforce with Black (formatter) + Flake8 (linter) + pydocstyle for docstrings.
* Type hints everywhereRun mypyâ€¯--strict in CI; avoid Any except when truly unavoidable.
* Immutable data modelsUse @dataclass(frozen=True) or Pydantic BaseModel with Config.allow_mutation=False.
2. Dependency & Environment Management
* Poetry or pipâ€‘tools for reproducible installs:
    * Lock poetry.lock / requirements.txt.
    * Pin to exact versions; review lockfile diffs in PRs.
* Virtual environments per project (no global installs).
* Separate Dockerfiles for dev vs. prod; multiâ€‘stage builds to minimize image size.
3. Configuration & Secrets
* Pydantic BaseSettings backed by ENV + .env for typed config.
* Never import os.getenv throughout codeâ€”read all settings at bootstrap, pass via constructor.
* Vault or AWS Secrets Manager for production; fall back to envâ€‘vars in staging/dev.
4. Packaging & Releases
* Structure as a proper Python package (src/ layout).
* Use setup.cfg/pyproject.toml metadata; publish to private PyPI if reusable.
* Automate changelog & version bump via Commitizen or Semanticâ€‘Release.
5. VPS Deployment & Web Server
* Docker Compose (or Kubernetes) on VPS for service isolation.
* Nginx â†’ Gunicorn/Uvicorn reverse proxy:
    * Set worker_processes = auto, timeout = 30s.
    * Run Gunicorn as a systemd service with proper User/Group.
* Firewall (ufw or iptables): only open ports 80/443 and SSH.
* Letâ€™s Encrypt (Certbot) autoâ€‘renew for TLS; verify via cron or systemd timer.
6. Crypto & Binance Integration
* Use the official pythonâ€‘binance SDK (or CCXT if multiâ€‘exchange).
* Decimalâ€‘based arithmetic (decimal.Decimal) for price/qtyâ€”never floats.
* API rateâ€‘limit handler: wrap calls with exponential backoff + jitter.
* Idempotency for order placement: generate unique clientOrderId.
* Maintain a local ledger DB of sent orders + responses to reconcile fills.
7. Security & Key Management
* Store API keys in encrypted vault; load at runtime, never commit.
* Restrict Binance key permissions (e.g. disable withdrawals unless testnet).
* Validate server time against NTP to avoid signature errors.
* Enable HTTP headers: HSTS, Xâ€‘Frameâ€‘Options, Content Security Policy.
8. Testing & CI/CD (Python Flavour)
* pytest with plugins:
    * pytestâ€‘asyncio for async routes
    * pytestâ€‘mock / vcr.py for replaying Binance HTTP interactions
* FactoryBoy or faker for test data; avoid liveâ€‘trading in CI (use testnet mocks).
* CI pipeline:
    1. Black â†’ Flake8 â†’ MyPy
    2. Unit tests â†’ Coverage (â†’ fail if <â€¯90â€¯%)
    3. Build Docker image â†’ Push to registry â†’ Deploy to staging
9. Logging, Monitoring & Alerting
* Structured JSON logs via structlog or loguru; include request_id, user_id.
* Expose Prometheus metrics endpoint; track order rates, latencies, error counts.
* Integrate Sentry for exception capture (with PII scrubbing).
10. Performance & Scalability
* Async frameworks (FastAPI / AIOHTTP) for highâ€‘throughput I/O.
* Offload longâ€‘running tasks (e.g. heavy charting, backtests) to Celery + Redis.
* Use Redis or Memcached for caching rateâ€‘limit buckets, market data TTL.

CRYPTO FUTURES BOT
Connect to your Hetzner server:ssh -i ~/.ssh/binance_futures_tool root@78.47.150.122

Hetzner server SSH key
-----BEGIN OPENSSH PRIVATE KEY-----b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZWQyNTUxOQAAACCgKpg75l42bl6nqPGB19mhr3u/FvLqpVM+F6h83KfQngAAAKA5gORcOYDkXAAAAAtzc2gtZWQyNTUxOQAAACCgKpg75l42bl6nqPGB19mhr3u/FvLqpVM+F6h83KfQngAAAECVjT6ZU1OJy2CpOaaBDrABKwO/XHGsxASibDLcrTBy+qAqmDvmXjZuXqeo8YHX2aGve78W8uqlUz4XqHzcp9CeAAAAHWJpbmFuY2UtZnV0dXJlcy10b29sLTIwMjUwNjAx-----END OPENSSH PRIVATE KEY-----
BinanceAPI Key
Nv38Jox0skxIGVNu24JgviZZCapB5pmzKLO39BDAjkdozbTUNy7nfBt1XW8hy28y
Secret Key
pNkrX9RBkEouPdzxhkH3ZfjLInZ0vWsEQrNNk2REnUAbuEogRIt5tfPa6Hc8qENm


ðŸŽ¯ Repository & Deployment
GitHub:Â https://github.com/Global-Digital-Assets/Buying-tool-v2

ðŸ”‘ Server Access

bash
CopyInsert
# SSH
ssh -i ~/.ssh/binance_futures_tool  root@78.47.150.122
# Service logs (follow)
journalctl -u futures-bot -f
NOTEâ€ƒKeep the SSH private-key & Binance API keys in your own secrets store â€“ doÂ notÂ commit them anywhere.

ðŸ“‚ Project Layout (/srv/futures-bot)


CopyInsert
bot/
 â”œâ”€ main.py            # FastAPI app + APScheduler
 â”œâ”€ exchange.py        # Binance interaction & order logic
 â”œâ”€ risk.py            # Dynamic TP calc + tiers
 â”œâ”€ conf_decay.py      # Exponential confidence decay helper
 â”œâ”€ signal.py          # Analytics API consumer
 â””â”€ __init__.py
config/
 â””â”€ token_buckets.yaml # Volatility groups & base TP%
data/
 â”œâ”€ trades.sqlite      # Raw event log (aiosqlite)
 â””â”€ outcomes.csv       # Realised PnL CSV
.env                   # Credentials & flags (chmod 600)
requirements.txt

âš™ï¸ .env (essential keys only)

bash
CopyInsert
API_KEY=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
API_SECRET=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
BINANCE_TESTNET=false                # true = testnet
ANALYTICS_API_URL=http://78.47.150.122:8080/api/analysis
TRADING_ENABLED=true                 # flip to false to halt new trades
# Feature flags
PROTECTIVE_DELAY_SEC=10              # wait before TP/SL (race-condition guard)
PARTIAL_TP=true
TP1_FRAC=0.5                         # 50 % offload at TP1

ðŸ“Š Analytics API
â€¢ GETÂ 
/api/analysisÂ â†’ list of actionable signals (symbol,Â side,Â confidence)
â€¢ GETÂ /api/statusâ€ƒâ†’ health JSON


ðŸ“ˆ 6-Tier Confidence Table
| Tier | Confidence | Leverage | Position % (wallet) | Base-TP (%) | |------|------------|----------|---------------------|-------------| | 1 | 95-100 % | 10Ã— | 12 % | 4.5 | | 2 | 85-94 % | 8Ã— | 10 % | 4.0 | | 3 | 75-84 % | 7Ã— | 8 % | 3.5 | | 4 | 70-74 % | 6Ã— | 6 % | 3.0 | | 5 | 65-69 % | 5Ã— | 4 % | 2.8 | | 6 | 60-64 % | 3Ã— | 3 % | 2.5 |
TP is then dynamically scaled:


CopyInsert
tp = bucket_base * (0.8 + confidence*0.4) * sqrt(hold_hours/3)
SL  = max(1 %, 2 Ã— TP)

ðŸ“„ token_buckets.yaml (editable live)

yaml
CopyInsert
volatility_groups:
  ultra_stable:
    tokens: [BTC, ETH, BNB]
    tp_base: 1.0
  stable:
    tokens: [ADA, SOL, XRP, DOT, MATIC, LINK, LTC, TRX]
    tp_base: 1.5
  moderate:
    tokens: [AVAX, ATOM, AAVE, NEAR]
    tp_base: 2.0
  volatile:
    tokens: [PEPE, SHIB, DOGE, GMT, SAND]
    tp_base: 3.0
Add / move tokens as needed; no redeploy required.

ðŸ”„ Trade Cycle (runs every 15 min)
1. Fetch signals (30 symbols).
2. FilterÂ side âˆˆ {BUY_LONG, BUY_SHORT}Â &Â confidence â‰¥ 60 %.
3. Skip symbol if already positioned.
4. Map confidence â†’ tier (table above).
5. Calculate dynamic TP, SL.
6. Place entry (market), SL, and TP orders.â€¢ IfÂ PARTIAL_TP=trueÂ â€“ TP1 closes 50 % (reduceOnly); SL full qty.
7. WriteÂ TP_OKÂ /Â SL_OKÂ events to DB + Telegram (errors only).

ðŸ›¡ï¸ Position-Lifecycle Manager (15 min)
â€¢ HARD STOPâ€ƒClose after 6 h.â€¢ SIGNAL FLIPâ€ƒClose if opposite direction â‰¥ 0.60 conf.â€¢ CONFIDENCE DECAYâ€ƒClose when decayed < 0.40.â€¢ Partial-TP flow: â€“ Detect TP1 fill (qty â‰ˆ 50 % of original).â€“ Cancel remaining orders; set breakeven SL; state = REDUCING.

ðŸ”§ Operations

bash
CopyInsert
# Service control
systemctl start/stop/restart futures-bot
systemctl status futures-bot

# Live tail
journalctl -u futures-bot -f

# Health endpoint
curl http://localhost:8000/health
# -> {"status":"OK","trading_enabled":true,"active_positions":n}
Emergency halt / resume:

bash
CopyInsert
curl -X POST http://localhost:8000/halt
curl -X POST http://localhost:8000/resume

âœ… Current Feature Checklist
| Feature | Status | |---------|--------| | Dynamic TP/SL via YAML buckets | âœ… | | 6-tier leverage + pos % | âœ… | | 10 s protective-order delay | âœ… | | Partial-TP (50 % + breakeven) | âœ… | | 6 h hard-stop | âœ… | | Signal-flip close | âœ… | | Confidence-decay close | âœ… | | PositionState guards | âœ… | | Outcome CSV logging | âœ… | | Telegram error alerts | âœ… (setÂ 
TELEGRAM_TOKENÂ +Â CHAT_ID) |
